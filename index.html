<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Autumn Lake Madness</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap');
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Inter', sans-serif; background: #0a0a0a; min-height: 100vh; color: #fff; }

  /* HEADER */
  .hero { background: linear-gradient(135deg, #0a0a0a 0%, #1a1a0a 50%, #0a1a0a 100%); border-bottom: 3px solid #c9a227; padding: 28px 20px 20px; text-align: center; position: relative; overflow: hidden; }
  .hero::before { content: ''; position: absolute; inset: 0; background: radial-gradient(ellipse at 50% 0%, rgba(201,162,39,0.12) 0%, transparent 70%); }
  .hero-inner { position: relative; z-index: 1; }
  .hero-eyebrow { font-family: 'Oswald', sans-serif; font-size: 11px; letter-spacing: 4px; color: #c9a227; text-transform: uppercase; margin-bottom: 8px; }
  .hero-title { font-family: 'Oswald', sans-serif; font-size: clamp(36px, 8vw, 64px); font-weight: 700; text-transform: uppercase; letter-spacing: 2px; line-height: 1; color: #fff; text-shadow: 0 0 40px rgba(201,162,39,0.3); margin-bottom: 6px; }
  .hero-title span { color: #c9a227; }
  .hero-sub { font-size: 13px; color: #888; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 16px; }
  .hero-badges { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; }
  .badge { display: inline-flex; align-items: center; gap: 6px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 5px 14px; font-size: 12px; color: #aaa; font-weight: 600; letter-spacing: 0.5px; }
  .badge.live { border-color: rgba(90,200,90,0.4); color: #5ac85a; }
  .live-dot { width: 7px; height: 7px; background: #5ac85a; border-radius: 50%; animation: pulse 1.5s infinite; }
  @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(0.8)} }
  .day-pill { background: #c9a227; color: #000; font-family: 'Oswald', sans-serif; font-size: 14px; font-weight: 700; letter-spacing: 1px; padding: 6px 20px; border-radius: 4px; text-transform: uppercase; }

  /* TICKER */
  .ticker { background: #c9a227; padding: 7px 0; overflow: hidden; white-space: nowrap; }
  .ticker-inner { display: inline-block; animation: ticker 25s linear infinite; font-family: 'Oswald', sans-serif; font-size: 13px; font-weight: 600; color: #000; letter-spacing: 1px; text-transform: uppercase; }
  @keyframes ticker { from{transform:translateX(100vw)} to{transform:translateX(-100%)} }
  .ticker-inner { animation-duration: 60s !important; }

  /* MAIN */
  .main { max-width: 760px; margin: 0 auto; padding: 24px 16px; }

  /* SECTION HEADER */
  .section-head { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; }
  .section-head h2 { font-family: 'Oswald', sans-serif; font-size: 18px; font-weight: 700; text-transform: uppercase; letter-spacing: 2px; color: #fff; }
  .section-line { flex: 1; height: 1px; background: linear-gradient(90deg, #333, transparent); }
  .section-tag { font-size: 11px; color: #c9a227; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; }

  /* LEADERBOARD */
  .lb-wrap { background: #111; border: 1px solid #222; border-radius: 4px; overflow: hidden; margin-bottom: 28px; }
  .lb-head { display: grid; grid-template-columns: 52px 1fr 100px 80px; padding: 10px 16px; background: #161616; border-bottom: 1px solid #2a2a2a; }
  .lb-head span { font-family: 'Oswald', sans-serif; font-size: 11px; font-weight: 600; letter-spacing: 2px; color: #555; text-transform: uppercase; }
  .lb-head span:nth-child(3), .lb-head span:last-child { text-align: right; }

  .row { display: grid; grid-template-columns: 52px 1fr 100px 80px; padding: 14px 16px; align-items: center; border-bottom: 1px solid #1a1a1a; transition: background 0.15s; cursor: default; }
  .row:last-child { border-bottom: none; }
  .row:hover { background: #161616; }
  .row.r1 { background: linear-gradient(90deg, rgba(201,162,39,0.08) 0%, transparent 60%); border-left: 3px solid #c9a227; }
  .row.r2 { background: linear-gradient(90deg, rgba(180,190,210,0.05) 0%, transparent 60%); border-left: 3px solid #8a9bb5; }
  .row.r3 { background: linear-gradient(90deg, rgba(160,112,74,0.06) 0%, transparent 60%); border-left: 3px solid #a0704a; }
  .row.r1:hover { background: linear-gradient(90deg, rgba(201,162,39,0.14) 0%, transparent 60%); }

  .rank-col { text-align: center; }
  .rank-num { font-family: 'Oswald', sans-serif; font-size: 22px; font-weight: 700; color: #333; }
  .rank-num.gold { color: #c9a227; }
  .rank-num.silver { color: #8a9bb5; }
  .rank-num.bronze { color: #a0704a; }
  .medal { font-size: 22px; }

  .name-col { padding: 0 12px; }
  .fname { font-family: 'Oswald', sans-serif; font-size: 17px; font-weight: 600; color: #fff; letter-spacing: 0.5px; text-transform: uppercase; margin-bottom: 6px; }
  .bar-wrap { height: 3px; background: #222; border-radius: 2px; }
  .bar { height: 3px; border-radius: 2px; background: linear-gradient(90deg, #c9a227, #e8c84a); transition: width 0.6s ease; }
  .row.r2 .bar { background: linear-gradient(90deg, #8a9bb5, #b0c0d5); }
  .row.r3 .bar { background: linear-gradient(90deg, #a0704a, #c08060); }

  .score-col { text-align: right; font-family: 'Oswald', sans-serif; font-size: 24px; font-weight: 700; color: #fff; }
  .change-col { text-align: right; }
  .change-pill { display: inline-block; font-size: 12px; font-weight: 700; font-family: 'Oswald', sans-serif; letter-spacing: 0.5px; padding: 3px 8px; border-radius: 3px; }
  .change-pill.up { background: rgba(90,200,90,0.15); color: #5ac85a; }
  .change-pill.zero { background: rgba(255,255,255,0.05); color: #444; }
  .change-pill.down { background: rgba(200,90,90,0.15); color: #c85a5a; }

  /* STATS BAR */
  .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 24px; }
  .stat { background: #111; border: 1px solid #222; border-radius: 4px; padding: 16px; text-align: center; }
  .stat-val { font-family: 'Oswald', sans-serif; font-size: 28px; font-weight: 700; color: #c9a227; }
  .stat-label { font-size: 11px; color: #555; text-transform: uppercase; letter-spacing: 1px; margin-top: 2px; }

  .footer { text-align: center; font-size: 11px; color: #333; padding: 20px 0; letter-spacing: 1px; text-transform: uppercase; }
  .loading { text-align: center; padding: 48px; color: #333; font-family: 'Oswald', sans-serif; font-size: 16px; letter-spacing: 2px; text-transform: uppercase; }
  .err { color: #c85a5a; }
</style>
</head>
<body>

<div class="hero">
  <div class="hero-inner">
    <div class="hero-eyebrow">Autumn Lake Healthcare</div>
    <div class="hero-title"><span>Autumn Lake</span> Madness</div>
    <div class="hero-sub">10-Day Facebook Follower Challenge</div>
    <div class="hero-badges">
      <div class="badge live"><span class="live-dot"></span>Live</div>
      <div class="day-pill" id="dayPill">Day ‚Äî of 10</div>
      <div class="badge" id="lastUpdate">Loading...</div>
    </div>
  </div>
</div>

<div class="ticker">
  <span class="ticker-inner" id="tickerText">üèÜ AUTUMN LAKE MADNESS &nbsp;¬∑&nbsp; 10-DAY FOLLOWER CHALLENGE &nbsp;¬∑&nbsp; WHO WILL TAKE THE CROWN? &nbsp;¬∑&nbsp; FOLLOW YOUR FACILITY &nbsp;¬∑&nbsp; üèÜ AUTUMN LAKE MADNESS &nbsp;¬∑&nbsp; 10-DAY FOLLOWER CHALLENGE &nbsp;¬∑&nbsp; WHO WILL TAKE THE CROWN?</span>
</div>

<div class="main">
  <div class="stats" id="statsBar" style="display:none">
    <div class="stat"><div class="stat-val" id="statTotal">0</div><div class="stat-label">Total New Followers</div></div>
    <div class="stat"><div class="stat-val" id="statLeader">‚Äî</div><div class="stat-label">Current Leader</div></div>
    <div class="stat"><div class="stat-val" id="statDaysLeft">‚Äî</div><div class="stat-label">Days Remaining</div></div>
  </div>

  <div class="section-head">
    <h2>Standings</h2>
    <div class="section-line"></div>
    <div class="section-tag">Live Rankings</div>
  </div>

  <div class="lb-wrap">
    <div class="lb-head">
      <span>Rank</span><span>Facility</span><span>Followers</span><span>+/-</span>
    </div>
    <div id="leaderboard"><div class="loading">Loading Standings...</div></div>
  </div>
</div>

<div class="footer">Autumn Lake Healthcare &nbsp;¬∑&nbsp; Autumn Lake Madness &nbsp;¬∑&nbsp; Auto-refreshes every 60s</div>

<script>
  const SUPABASE_URL = "https://weshcdumagibvoxnwstn.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc2hjZHVtYWdpYnZveG53c3RuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwNDM1NTEsImV4cCI6MjA4NzYxOTU1MX0.rLBG_vDhd2ClVQSmHm-FgsIaOPZWZOImNEdn-tfwsyo";
  const HEADERS = { "apikey": SUPABASE_KEY, "Authorization": "Bearer " + SUPABASE_KEY };

  async function fetchScores() {
    try {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/leaderboard?order=id.asc`, { headers: HEADERS });
      const rows = await res.json();
      if (!Array.isArray(rows) || !rows.length) return;

      const sorted = [...rows].sort((a, b) => b.new_followers - a.new_followers);
      const max = Math.max(...sorted.map(r => r.new_followers), 1);
      const day = rows[0].day || 1;
      const total = rows.reduce((s, r) => s + r.new_followers, 0);
      const daysLeft = Math.max(0, 10 - day);

      document.getElementById('dayPill').textContent = `Day ${day} of 10`;
      document.getElementById('lastUpdate').textContent = `Updated ${new Date().toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'})}`;
      document.getElementById('statsBar').style.display = 'grid';
      document.getElementById('statTotal').textContent = total.toLocaleString();
      document.getElementById('statLeader').textContent = sorted[0]?.facility_name?.split(' ').slice(-1)[0] || '‚Äî';
      document.getElementById('statDaysLeft').textContent = daysLeft;

      // Update ticker with real names
      const names = sorted.map((r,i) => `#${i+1} ${r.facility_name.toUpperCase()}: ${r.new_followers} FOLLOWERS`).join(' &nbsp;¬∑&nbsp; ');
      document.getElementById('tickerText').innerHTML = `üèÜ ${names} &nbsp;¬∑&nbsp; üèÜ ${names}`;

      const rankClass = ['r1','r2','r3'];
      const medals = ['ü•á','ü•à','ü•â'];

      document.getElementById('leaderboard').innerHTML = sorted.map((r, i) => {
        const change = r.new_followers - r.previous_followers;
        const pct = Math.round((r.new_followers / max) * 100);
        const changeHtml = change > 0
          ? `<span class="change-pill up">+${change}</span>`
          : change < 0
          ? `<span class="change-pill down">${change}</span>`
          : `<span class="change-pill zero">‚Äî</span>`;
        const rankHtml = i < 3
          ? `<span class="medal">${medals[i]}</span>`
          : `<span class="rank-num">${i+1}</span>`;
        return `
          <div class="row ${i < 3 ? rankClass[i] : ''}">
            <div class="rank-col">${rankHtml}</div>
            <div class="name-col">
              <div class="fname">${r.facility_name}</div>
              <div class="bar-wrap"><div class="bar" style="width:${pct}%"></div></div>
            </div>
            <div class="score-col">${r.new_followers.toLocaleString()}</div>
            <div class="change-col">${changeHtml}</div>
          </div>`;
      }).join('');
    } catch(e) {
      document.getElementById('leaderboard').innerHTML = '<div class="loading err">Error loading. Refreshing...</div>';
    }
  }

  setInterval(fetchScores, 60000);
  fetchScores();
</script>
</body>
</html>
